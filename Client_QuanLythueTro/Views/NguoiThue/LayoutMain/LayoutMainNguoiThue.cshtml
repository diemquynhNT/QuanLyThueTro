@using Newtonsoft.Json
@using Microsoft.AspNetCore.Http
@{
    var userJson = Context.Session.GetString("user");
    Users user = null;
    if (userJson != null)
    {
        user = JsonConvert.DeserializeObject<Users>(userJson);
    }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link href="~/css/lauoutcct.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="~/css/layoutct.css" rel="stylesheet" />
    <link href="~/css/layoutnguoithue.css" rel="stylesheet" />




</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light sticky-top justify-content-center" style="background: #0E566A">
            <div class="container">
                <a class="navbar-brand font-weight-bold" href="#" style="visibility: hidden;">Menu</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav  me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="menutab active" aria-current="page" href="~/ChuChoThue/IndexTinDangPT">Trang chủ</a>
                        </li>
                        <li class="nav-item">
                            <a class="menutab" href="#">Cho thuê phòng trọ</a>
                        </li>
                        <li class="nav-item">
                            <a class="menutab" href="#">Nhà cho thuê</a>
                        </li>
                        <li class="nav-item">
                            <a class="menutab" href="#">Cho thuê căn hộ</a>
                        </li>
                        <li class="nav-item">
                            <a class="menutab" href="#">Tìm người ở ghép</a>
                        </li>
                        <li class="nav-item">
                            <a class="menutab" href="#">Tin tức</a>
                        </li>
                        <li class="nav-item">
                            <a class="menutab" href="#">Bảng giá dịch vụ</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-lg-2 d-none d-lg-block bg-light sidebar">
                <div class="user_info">
                    <div href="#" class="clearfix">
                        <div class="user_avatar">
                            @if (user.hinhAnh != null)
                            {
                                <input value="@user.idUser" style="visibility:hidden" />
                                <img id="image">
                            }else
                            {
                                <img src="/img/user.png">
                            }
                        </div>
                        <div class="user_meta">
                            <div class="inner">					
                                <div class="user_name">@user.hoTen</div>
                                <div class="user_verify" style="color: #555; font-size: 0.9rem;">@user.sdtUsers</div>
                            </div>
                        </div>
                    </div>
                    <ul>
                        <li><span>Mã thành viên:</span> 
                            <span style="font-weight: 700;"> @user.idUser</span>
                        </li>
                        <li>
                            <span>Loại khách:</span>
                            <span style="font-weight: 700;"> @user.idChucVu</span>
                        </li>
                    </ul>
                    <a class="btn btn-danger btn-sm" href="" style="width: 100%; margin: 10px 0;" previewlistener="true">Đăng tin</a>
    			</div>
                
                <ul class="nav nav-sidebar">
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.qltd" asp-controller="NguoiThue" asp-action="QuanLyTinDang" asp-route-idUser="@user.idUser" previewlistener="true">
                        <i class='bx bx-file'></i>  
                            Quản lý tin đăng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.tinyeuthich" asp-controller="NguoiThue" asp-action="QuanLyTinYeuThichCaNhan" asp-route-idUser="@user.idUser" previewlistener="true">
                            <i class='bx bx-home-heart'></i>
                            Tin yêu thích
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.lichxem" asp-controller="NguoiThue" asp-action="QuanLyLichXemCaNhan" asp-route-sdt="@user.sdtUsers" previewlistener="true">
                            <i class='bx bx-calendar'></i>
                            Lịch xem phòng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.tincanhan" asp-controller="NguoiThue" asp-action="ThongTinCaNhan" asp-route-idUser="@user.idUser" previewlistener="true">
                        <i class='bx bx-user-pin'></i>
                        Thông tin cá nhân
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.thanhtoan" href="" previewlistener="true">
                        <i class='bx bx-credit-card-front'></i>
                        Lịch sử thanh toán
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.chat" href="" previewlistener="true">
                            <i class='bx bx-message-dots'></i>
                        Liên hệ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @ViewBag.logout" href="@Url.Action("LogoutCustomer", "Login")" previewlistener="true">
                            <i class='bx bx-log-out'></i>
                        Thoát
                        </a>
                    </li>
                </ul>
            </nav>
            @{
                List<Breadcrumb> listLink = ViewBag.Breadcrumbs;
            }
            <main role="main" class="ml-sm-auto col-lg-10" style="margin-top: 20px;">
                <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        @if(listLink !=null)
                        {
                            foreach (var breadcrumb in listLink)
                            {
                                <li class="breadcrumb-item">
                                    @if (!string.IsNullOrEmpty(breadcrumb.Url))
                                    {
                                        <a href="@breadcrumb.Url">@breadcrumb.Label</a>
                                    }
                                    else
                                    {
                                        <span>@breadcrumb.Label</span>
                                    }
                                </li>
                            }
                            <li class="breadcrumb-item active" aria-current="page">@ViewBag.title</li>
                        }
                    </ol>
                </nav>
                @RenderBody()
                @RenderSection("scripts", false)

            <br><br>
            </main>
                </div>
    </div>
    <script src="~/js/plugin/jquery.datatables.min.js"></script>
    <script src="~/js/plugin/datatables.bootstrap.min.js"></script>

    <script type="text/javascript">$('#sampleTable').DataTable();</script>
    <script type="text/javascript">$('#sampleTable1').DataTable();</script>


    <script>
        $('#sampleTable').DataTable(); //TimKiem
        function get_image() {
            var id = document.getElementById("idUsers").value;
            url = "https://localhost:7034/api/Users/GetImage?id=" + id;
            fetch(url)
                .then(function (response) {
                    return response.blob();
                })
                .then(function (data) {
                    console.log(data);
                    var img = document.getElementById("image");
                    img.src = URL.createObjectURL(data);
                })
                .catch(function (error) {
                    console.log("Error: " + error);
                });
        }
       

        get_image();
    </script>
</body>
</html>